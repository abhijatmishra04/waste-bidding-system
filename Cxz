from rai_gateway_client import RAIGatewayClient

# Create client with custom retry/backoff knobs
client = RAIGatewayClient(
    config_file="config/rai_config.cfg",
    profile=None,                       # or "WITH_GUARDRAIL"
    max_retries=4,                      # number of retry attempts
    backoff_base_seconds=0.5,           # initial backoff base
    backoff_max_seconds=8.0,            # max backoff wait
    max_total_retry_seconds=25.0,       # cap total retry time
    connect_timeout_seconds=5.0,        # socket connect timeout
    read_timeout_seconds=60.0,          # API call timeout
    breaker_fail_threshold=5,           # open breaker after 5 fails
    breaker_half_open_after=20.0        # test again after 20s
)

# Call chat endpoint
resp = client.call_chat(
    messages=[
        {"role": "system", "content": "You are a helpful assistant."},
        {"role": "user", "content": "Give me a JSON with a random number."},
    ],
    model="azure-openai.gpt-4o",
    guardrail_profile="WITH_GUARDRAIL",  # or None
)

print("Response:", resp)
print("Metrics:", client.get_metrics())
