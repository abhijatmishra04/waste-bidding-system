
import configparser
from rai_gateway_client import RAIGatewayClient, RAIError

# Step 1: Load config
config = configparser.ConfigParser()
config.read("config/rai_config.cfg")
cfg = config["DEFAULT"]

# Step 2: Create client from your utility
client = RAIGatewayClient(
    base_url=cfg["host"],
    rai_client_id=cfg["rai_client_id"],
    client_id=cfg.get("eam_consumer_key"),
    client_secret=cfg.get("eam_consumer_secret"),
    max_retries=3,
    backoff_base_seconds=0.5,
    backoff_max_seconds=8.0,
    max_total_retry_seconds=30,
    connect_timeout_seconds=3,
    read_timeout_seconds=60,
)

# Step 3: Make a safe call to RAI Gateway
try:
    response = client.call_chat(
        messages=[
            {"role": "system", "content": "You are a helpful assistant."},
            {"role": "user", "content": "Return a random number in JSON format."},
        ],
        model="gpt-4o-mini",
    )
    print("Response:", response)

except RAIError as e:
    print(f"RAI call failed: code={e.code}, status={e.status_code}, msg={e}")

# Step 4: Print metrics
print("Metrics:", client.get_metrics())
