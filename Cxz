Custagg Job Overview

Purpose:
	•	This job processes a file received from another system (MME jobs), usually every Sunday between 7:00 AM to 11:00 AM.
	•	It compares, deduplicates, adjusts, and updates account-related information based on product codes and static mapping.

⸻

Steps Summary:

1. File Inputs
	•	It uses two files:
	•	ESBP.SQ.REFER.DATA.FILE → From MME
	•	ESBP.SQ.REFER.ENTY.FILE → Static file containing entity mappings.

⸻

2. Processing Steps
	•	Compare Custagg file with Entity file to get alphanumeric entity code.
	•	Remove duplicates based on Product Code, Entity, Account Number.
	•	Extract fields like Product Code, Entity, and Account Number from a master account table.
	•	Shift/Adjust data:
	•	Example: Shift 00000000308604 to PERRNRI, meaning a transformation/mapping.
	•	Remove duplicates again after shifting data.
	•	Change Account# size:
	•	Earlier: 21 bytes
	•	Now: 23 bytes

⸻

3. Account Number Extraction Rules
	•	Depending on Product Codes, account number should be extracted from different positions in the file.
	•	Example:
	•	If Product is CLS or ILI, take Account# from position 11:13
	•	If Product is PER, SBA, or BUS, from position 12:12
	•	If Product is CDS, RAA, etc., from position 10:14
	•	If Product is RAP, from position 9:15
	•	etc.
	•	If no special product code matches, default: take 23 bytes as Account Number.

⸻

4. Matching and Updating:
	•	Identify matching records between Custagg file and Account table.
	•	Find the schedule for the account:
	•	If an account is closed (S02 schedule type), update it with the current date and a timestamp.
	•	If payment is active, mark the payment as failed (HO2 status) and update order history.

