@Test
public void testProcess_UpdateTransferInstructionSuccess() throws Exception {
    // Arrange
    when(jdbcTemplate.queryForObject(eq(CustaggSQLFactory.FETCH_SCHEDULE_ID_ACCOUNT_BOA), eq(String.class), any()))
            .thenReturn("SCHED123");
    when(jdbcTemplate.queryForObject(eq(CustaggSQLFactory.FETCH_TRANSFER_EXECUTION_M2M_ID), eq(String.class), any()))
            .thenReturn("EXEC456");
    when(jdbcTemplate.queryForObject(eq(CustaggSQLFactory.FETCH_TRANSFER_INSTRUCTION_ID), eq(String.class), any()))
            .thenReturn("INSTR789");

    doNothing().when(jdbcTemplate).update(
            eq(CustaggSQLFactory.UPDATE_TRANSFER_INSTRUCTION_M2M), any(), any(), any(), any()
    );

    // Act
    CustaggProcessedRecordsDTO result = processor.process(input);

    // Assert
    assertNotNull(result);
    assertTrue(result.getTransferExecutionIds().contains("EXEC456"));
    verify(jdbcTemplate, times(1)).update(eq(CustaggSQLFactory.UPDATE_TRANSFER_INSTRUCTION_M2M),
            eq("HQ2"), eq("Custagg"), any(Timestamp.class), eq("INSTR789"));
}

@Test
public void testProcess_UpdateTransferInstructionFailure() throws Exception {
    // Arrange
    when(jdbcTemplate.queryForObject(eq(CustaggSQLFactory.FETCH_SCHEDULE_ID_ACCOUNT_BOA), eq(String.class), any()))
            .thenReturn("SCHED123");
    when(jdbcTemplate.queryForObject(eq(CustaggSQLFactory.FETCH_TRANSFER_EXECUTION_M2M_ID), eq(String.class), any()))
            .thenReturn("EXEC456");
    when(jdbcTemplate.queryForObject(eq(CustaggSQLFactory.FETCH_TRANSFER_INSTRUCTION_ID), eq(String.class), any()))
            .thenReturn("INSTR789");

    doThrow(new RuntimeException("Update Failed")).when(jdbcTemplate).update(
            eq(CustaggSQLFactory.UPDATE_TRANSFER_INSTRUCTION_M2M), any(), any(), any(), any()
    );

    // Act
    CustaggProcessedRecordsDTO result = processor.process(input);

    // Assert
    assertNotNull(result);
    verify(jdbcTemplate, times(1)).update(eq(CustaggSQLFactory.UPDATE_TRANSFER_INSTRUCTION_M2M),
            eq("HQ2"), eq("Custagg"), any(Timestamp.class), eq("INSTR789"));
}
