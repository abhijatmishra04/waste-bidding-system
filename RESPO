package com.bofa.sst.batch.core;

import lombok.extern.slf4j.Slf4j;
import org.springframework.batch.item.ItemWriter;
import org.springframework.stereotype.Component;

import java.io.BufferedWriter;
import java.io.FileWriter;
import java.io.IOException;
import java.util.List;

@Component
@Slf4j
public class TemporaryWriter implements ItemWriter<EnrichedRecordDTO> {

    @Override
    public void write(List<? extends EnrichedRecordDTO> items) throws Exception {
        // Define the temporary output file
        String tempOutputPath = "temp_output.txt";

        try (BufferedWriter writer = new BufferedWriter(new FileWriter(tempOutputPath))) {
            log.info("Writing to temporary file: {}", tempOutputPath);

            for (EnrichedRecordDTO item : items) {
                // Log each record
                log.info("Writing Enriched Record: {}", item);

                // Write to the file
                writer.write(item.toString());
                writer.newLine();
            }

            log.info("Finished writing all records to temporary file.");
        } catch (IOException e) {
            log.error("Error occurred while writing to temporary file.", e);
            throw new RuntimeException("Error writing to temporary file", e);
        }
    }
}
