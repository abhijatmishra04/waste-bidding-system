private void fetchAndUpdateTransferInstructionIds(List<String> scheduleIds) {
    for (String scheduleId : scheduleIds) {
        try {
            // Fetch the transfer instruction ID using only the schedule ID
            String transferInstructionId = jdbcTemplate.queryForObject(
                CustaggSQLFactory.FETCH_TRANSFER_INSTRUCTION_ID,
                String.class,
                new Object[]{scheduleId}
            );

            // Update transfer instruction M2M if a valid transferInstructionId is found
            if (transferInstructionId != null) {
                updateTransferInstruction(transferInstructionId);
                Log.trace("Updated Transfer Instruction M2M for ID: {}", transferInstructionId);
            } else {
                Log.warn("No Transfer Instruction ID found for Schedule ID: {}", scheduleId);
            }
        } catch (DataAccessException e) {
            Log.error("Error fetching Transfer Instruction ID for Schedule ID: {}. Exception: {}", scheduleId, e.getMessage(), e);
        } catch (Exception e) {
            Log.error("Unexpected error fetching Transfer Instruction ID for Schedule ID: {}. Exception: {}", scheduleId, e.getMessage(), e);
        }
    }
}

private void updateTransferInstruction(String transferInstructionId) {
    try {
        jdbcTemplate.update(
            CustaggSQLFactory.UPDATE_TRANSFER_INSTRUCTION_M2M,
            "H02", // New Status
            "Custagg", // Updated By
            new Timestamp(System.currentTimeMillis()), // Updated Timestamp
            transferInstructionId
        );
        Log.debug("Successfully updated Transfer Instruction M2M for ID: {}", transferInstructionId);
    } catch (DataAccessException e) {
        Log.error("Error updating Transfer Instruction M2M for ID: {}. Exception: {}", transferInstructionId, e.getMessage(), e);
    } catch (Exception e) {
        Log.error("Unexpected error updating Transfer Instruction M2M for ID: {}. Exception: {}", transferInstructionId, e.getMessage(), e);
    }
}
